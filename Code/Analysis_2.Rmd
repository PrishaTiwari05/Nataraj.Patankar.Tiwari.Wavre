---
title: "Analysis_2"
author: "Nataraj.Patankar.Tiwari.Wavre"
date: "2025-04-16"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(lubridate)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
EV_Registrations_PW <- read_excel(
  path = here("Data/Raw/2016-2023 LDV Registration Data.xlsx"),
  col_names = TRUE
)

Fuel_Stations_PW <- read.csv(
file = here("Data/Raw/Fuel_Stations_Historical_Data.csv"),
stringsAsFactors = TRUE
)


```

## Data cleaning and filtering of EV registration

```{r}
EV_Registrations_Subset_PW <- EV_Registrations_PW %>%
  select(`Year`, `State`, `Electric (EV)`, `Plug-In Hybrid Electric (PHEV)`)

EV_Registrations_Subset_PW <- EV_Registrations_Subset_PW %>%
  arrange(Year)

# Convert full state names to abbreviations
EV_Registrations_Subset_PW$State <- state.abb[match(EV_Registrations_Subset_PW$State, state.name)]


EV_Registrations_Subset_PW$State[EV_Registrations_Subset_PW$State == "District of Columbia"] <- "DC"
```

## Data cleaning and filtering of charging stations

```{r}

# Keep only the required columns
Fuel_Stations_PW <- Fuel_Stations_PW[, c("Station.Name", "State", "Latitude", "Longitude", "Open.Date")]

Fuel_Stations_PW$Open.Date <- dmy(Fuel_Stations_PW$Open.Date)

Fuel_Stations_PW$Open.Date <- year(Fuel_Stations_PW$Open.Date)

Fuel_Stations_PW <- subset(Fuel_Stations_PW, Open.Date >= 2016 & Open.Date <= 2023)
```

## Data Wrangling

```{r}

# Adding a new column with EV + PHEV count. 
EV_Registrations_Subset_PW$`Total EVs` <- 
  EV_Registrations_Subset_PW$`Electric (EV)` + 
  EV_Registrations_Subset_PW$`Plug-In Hybrid Electric (PHEV)`

```

```{r}

Station_Counts <- Fuel_Stations_PW %>%
  group_by(Open.Date, State) %>%
  summarise(Number_of_Stations = n(), .groups = 'drop')

```
