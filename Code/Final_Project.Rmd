---
title: "Factors Affecting EV Adoption in the U.S."
author: "Nataraj.Patankar.Tiwari.Wavre"
date: "2025-04-24"
output: html_document
editor_options: 
  chunk_output_type: console
---

## Introduction
Electric vehicles (EVs) are rapidly transforming the U.S. transportation landscape, driven by growing concerns over climate change, rising fuel prices, and supportive policy incentives. As the market expands, understanding the factors that are influencing the adoption of EVs is critical for designing equitable and effective transportation policies.

## Background
The global transition toward EVs is accelerating, driven by government policies, technological advancements, and increasing environmental awareness. Alongside these developments, fueling infrastructure in the U.S. continues to play a critical role, both in supporting traditional internal combustion engine (ICE) vehicles and facilitating the growth of the EV market. Additionally, as EVs remain relatively new and expensive technology, areas with higher purchasing power, larger populations, and greater access to charging infrastructure may experience faster and more substantial adoption rates.

## Motivation
Analyzing the relationship between EV sales trends and fuel station infrastructure is essential for effective infrastructure planning, informed policymaking, and targeted investment strategies. As EV adoption accelerates, the demand for traditional gas stations is expected to decline, accompanied by a corresponding rise in the need for robust EV charging infrastructure. Understanding these evolving trends can guide strategic decisions on how the U.S. can best adapt its fueling networks to support the clean energy transition. Furthermore, examining demographic factors such as population density and income levels can help determine optimal locations for deploying EV charging stations.

## Information on Datasets
We used four primary datasets in this analysis:
1. The [Energy Efficiency and Renewable Energy's Alternative Fuels Dataset](https://afdc.energy.gov/stations/states) from U.S. Department of Energy provided alternative fueling station counts by state and fuel type, along with the vehicle registration counts.
2. Income data was sourced from the [U.S. Bureau of Economic Analysis](https://apps.bea.gov/itable/?ReqID=70&step=1&_gl=1*183o7fy*_ga*MTA2NTA5NzQzNS4xNzQ0NzQ1MTM1*_ga_J4698JNNFT*MTc0NTAwNzIyOS4zLjAuMTc0NTAwNzIyOS42MC4wLjA.#eyJhcHBpZCI6NzAsInN0ZXBzIjpbMSwyOV0sImRhdGEiOltbIlRhYmxlSWQiLCIyMSJdXX0=), which reports annual per capita personal income.
3. Population estimates were taken from the [U.S. Census Bureau](https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html), covering state-level populations for each year in the study period.
4. The U.S. Census Bureau also provided the [Cartographic Boundary Shapefiles](https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html) for all the states-5m.

## Setting up the Session
```{r setup, message=FALSE, warning=FALSE, results='hide'}
#Installing and loading packages
#install.packages("ggforce")
#install.packages("readxl")
library(tidyverse)
library(lubridate)
library(here)
library(ggplot2)
library(stringr)
library(cowplot)
library(ggforce)
library(scales)
library(dplyr)
library(readxl)
library(sf)
library(leaflet)
library(mapview); mapviewOptions(fgb = FALSE)

here()
```

## Importing and Cleaning Datasets

```{r datasets, message=FALSE, warning=FALSE}
#1. EV Registration Data
LDV_Data <- read_excel("Data/Raw/2016-2023 LDV Registration Data.xlsx")

#Renaming columns 
colnames(LDV_Data) [c(3,4)] <- c("EV", "PHEV")

#Selecting and creating columns
LDV_Clean <- LDV_Data %>%
  mutate(Total_EV = EV + PHEV) %>%
  select(Year, State, Total_EV, EV, PHEV)

#write.csv(LDV_Clean, "Data/Processed/LDV_Clean.csv", row.names = FALSE)

#2. Income Data
Income_Data <- read.csv("Data/Raw/Average Income Data by State.csv")

#Cleaning data
Income_Clean <- Income_Data %>%
  mutate(State = str_trim(str_remove(State, "\\*")))

#write.csv(Income_Clean, "Data/Processed/Avg_Income_Clean.csv", row.names = FALSE)

#3. Population Data
Pop_Data <- read_excel("Data/Raw/Population 2020-2024.xlsx")

#Renaming the columns
colnames(Pop_Data) [c(2,3,4,5)] <- c("Pop_2020","Pop_2021","Pop_2022","Pop_2023")

#Wrangling the data
Pop_Clean <- Pop_Data %>%
  pivot_longer(cols = starts_with("Pop_"), names_to = "Year", names_prefix = "Pop_", values_to = "Population") %>%
  select(Year, States, Population) %>%
  mutate(Year = as.numeric(Year))

#write.csv(Pop_clean, "Data/Processed/Population_Clean.csv", row.names = FALSE)

#4. Fuel Stations 
Fuel_Stations <- read.csv(file = here("Data/Raw/Fuel_Stations_Historical_Data.csv"),
stringsAsFactors = TRUE)

#Selecting columns
Fuel_Stations <- Fuel_Stations[, c("Station.Name", "State", "Latitude", "Longitude", "Open.Date")]

#Formatting dates
Fuel_Stations$Open.Date <- dmy(Fuel_Stations$Open.Date)
Fuel_Stations$Open.Date <- year(Fuel_Stations$Open.Date)
Fuel_Stations <- subset(Fuel_Stations, Open.Date >= 2016 & Open.Date <= 2023)

#Converting acronyms to state names 
Fuel_Stations$State <- toupper(trimws(Fuel_Stations$State)) 

state_abbr <- state.abb 
state_names <- state.name 

state_abbr <- c(state_abbr, "DC")
state_names <- c(state_names, "District of Columbia") #Added DC manually

Fuel_Stations$State <- state_names[match(Fuel_Stations$State, state_abbr)] 

#Regrouping the stations 
Fuel_Stations_Summary <- Fuel_Stations %>%
  group_by(Open.Date, State) %>%
  summarise(Number_of_Stations = n(), .groups = 'drop') %>%
  rename(Year = Open.Date)

#write.csv(Fuel_Stations_Summary, "Data/Processed/Fuel_Stations_Summary.csv", row.names = FALSE)
```

## Analysis 0: Visualizing Data through Graphs
### Summary Plots for EV Registration Data
Explain what we're doing here for each graph

```{r summary plots, message=FALSE, warning=FALSE}
#Plots of EV registrations
ggplot(LDV_Clean, aes(x = Year, y = `Total_EV`, color = State)) +
  geom_line(size = 1) +
  labs(
    title = "EV Registrations by State (2016–2023)",
    x = "Year",
    y = "Number of EVs Registered",
    color = "State"
  ) +
  theme_minimal(base_size = 14)

#Filtering the dataset for California
LDV_Clean %>%
  filter(State != "California") %>%
  ggplot(aes(x = Year, y = `Total_EV`, color = State)) +
  geom_line(size = 1) +
  labs(
    title = "EV Registrations by State (Excl. California, 2016–2023)",
    x = "Year",
    y = "Number of EVs Registered",
    color = "State"
  ) +
  theme_minimal(base_size = 14)

#Plotting California separately 
ggplot(filter(LDV_Clean, State == "California"), 
       aes(x = Year, y = `Total_EV`)) +
  geom_line(color = "navy", size = 1) +
  labs(
    title = "EV Registrations in California (2016–2023)",
    x = "Year", y = "EV Registrations"
  ) +
  theme_minimal(base_size = 12)

```

> Analysis: We can see that 

### Maps for Charging Stations Data
Explain what we're doing here (Creating a map of Charging Stations all of US - Includes Mainland USA, Alaska and Hawaii)

```{r maps, message=FALSE, warning=FALSE}
#Reading data
States_sf <- st_read( here('Data/Raw/cb_2018_us_state_5m/cb_2018_us_state_5m.shp'))
Stations_Data <- read.csv(file = here("Data/Raw/Fuel_Stations_Historical_Data.csv"),
stringsAsFactors = TRUE)

#
bbox_us <- st_bbox(c(xmin = -179, xmax = -66, ymin = 18.5, ymax = 72), crs = st_crs(States_sf))
States_sf_cropped <- st_crop(States_sf, bbox_us)

#
mapviewOptions(basemaps = "OpenStreetMap")
mapview(States_sf_cropped)

#Selecting required columns and removing rows which do not have valid latitude and longitude data
Stations_Map <- Stations_Data %>%
  filter(Fuel.Type.Code == "ELEC") %>%
  select(Fuel.Type.Code, Latitude, Longitude) %>%
  filter(
    !is.na(Longitude), !is.na(Latitude),
    Latitude >= 18.5, Latitude <= 72,
    Longitude <= -66, Longitude >= -179)

#write.csv(Stations_Map, "Data/Processed/EVStation_Locations.csv", row.names = FALSE)

#
Stations.sf <- Stations_Map %>%
  st_as_sf(
    coords = c('Longitude','Latitude'),
    crs=4269)

#Mapping the data
Plot_EVStationLocations <- ggplot()+
  geom_sf(data = States_sf, fill="white", size = 0.5) +
  geom_sf(data = Stations.sf, color = "red", size = 0.2)+
  ggtitle("EV Station Locations in the US")+
  coord_sf(
    xlim = c(-179, -66), 
    ylim = c(18.5, 72),    
    expand = FALSE)
Plot_EVStationLocations
```

### Map of Mainland U.S.
Write one line about why

```{r clean map, message=FALSE, warning=FALSE}
#
bbox_us2 <- st_bbox(c(xmin = -125, xmax = -66, ymin = 24, ymax = 50), crs = st_crs(States_sf))
States_sf_cropped2 <- st_crop(States_sf, bbox_us2)
mapview(States_sf_cropped2)

#Selecting required columns and removing rows which do not have valid latitude and longitude data
Mainland_Map <- Stations_Data %>%
  filter(Fuel.Type.Code == "ELEC") %>%
  select(Fuel.Type.Code, Latitude, Longitude) %>%
  filter(
    !is.na(Longitude), !is.na(Latitude),
    Latitude >= 24, Latitude <= 50,
    Longitude <= -66, Longitude >= -125)

#
Stations.sf2 <- Mainland_Map %>%
  st_as_sf(
    coords = c('Longitude','Latitude'),
    crs=4269)

#Mapping the data
Plot_EVStationLocations2 <- ggplot()+
  geom_sf(data = States_sf, fill="white", size = 0.5) +
  geom_sf(data = Stations.sf2, color = "red", size = 0.2)+
  ggtitle("EV Station Locations in the Mainland US")+
  coord_sf(
    xlim = c(-125, -66), 
    ylim = c(24, 50),    
    expand = FALSE)
Plot_EVStationLocations2
```

> Analysis: we see that 




